<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Code Checker</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" type="text/css" media="all" href="css/styles.css">
    <link href="css/scrolling-nav.css" rel="stylesheet">

      <link rel="shortcut icon" href="http://d15dxvojnvxp1x.cloudfront.net/assets/favicon.ico">
  <link rel="icon" href="http://d15dxvojnvxp1x.cloudfront.net/assets/favicon.ico">
  
  <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
  <script type="text/javascript" src="js/Chart.min.js"></script>

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">Code Checker</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#about">Score</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#services">Suggestions</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#contact">About</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <header class="bg-primary">
      <div id="w">
    <h1>Welcome to the Code Checker Tool</h1>
    <p>Enter a single Github username below and click the button to score the profile.</p>
    <div class="row">
      <input type="text" name="ghusername" id="ghusername" placeholder="Github username...">
    </div>
    
    <div class="row">
      <a class="btn score-btn" href="#" id="ghsubmitbtn">Score!</a>
      <form class="btn form-btn" action="#">
        <select name="cars">
          <option value="Python">Python</option>
          <option value="Fortran">Fortran</option>
          <option value="Java">Java</option>
          <option value="C++">C++</option>
          <option value="PHP">Node.js</option>
          <option value="PHP">JavaScript</option>
          <option value="PHP">PHP</option>
        </select>
      </form>
      
    </div>
    <div id="ghapidata" class="clearfix"></div>
  </div>
<script type="text/javascript">
$(function(){
  $('#ghsubmitbtn').on('click', function(e){
    e.preventDefault();
    $('#ghapidata').html('<div id="loader"><img src="css/loader.gif" alt="loading..."></div>');
    

    document.getElementById("profile_score").innerHTML = "";
    var username = $('#ghusername').val();
    var requri   = 'https://api.github.com/users/'+username;
    //var repouri  = 'https://api.github.com/users/'+username+'/repos';
	
	// Hard-coded "language:python" to restrict the repos to only those containing .py files, sorted in desc order by stars.
	var repouri  = 'https://api.github.com/search/repositories?q=+user:' + username + '+language:python&sort=stars&order=desc';
    
    requestJSON(requri, function(json) {
      if(json.message == "Not Found" || username == '') {
        $('#ghapidata').html("<h2>No User Info Found</h2>");
      }
      
      else {
        // else we have a user and we display their info
        var fullname   = json.name;
        var username   = json.login;
        var aviurl     = json.avatar_url;
        var profileurl = json.html_url;
        var location   = json.location;
        var followersnum = json.followers;
        var followingnum = json.following;
        var reposnum     = json.public_repos;
        
        if(fullname == undefined) { fullname = username; }
        
        var outhtml = '<h2>'+fullname+' <span class="smallname">(@<a href="'+profileurl+'" target="_blank">'+username+'</a>)</span></h2>';
        outhtml = outhtml + '<div class="ghcontent"><div class="avi"><a href="'+profileurl+'" target="_blank"><img src="'+aviurl+'" width="80" height="80" alt="'+username+'"></a></div>';
        outhtml = outhtml + '<p>Followers: '+followersnum+' - Following: '+followingnum+'<br>Repos: '+reposnum+'</p></div>';
        outhtml = outhtml + '<div class="repolist clearfix">';
        
        var repositories;
        $.getJSON(repouri, function(json){
          repositories = json.items;   
          outputPageContent();                
        });      
        
        
        
        function outputPageContent() {
          if(repositories.length == 0) { outhtml = outhtml + '<p>No python repos!</p></div>'; }
          else {
            outhtml = outhtml + '<p><strong>Python Repos List:</strong></p> <ul>';
            $.each(repositories, function(index) {
              outhtml = outhtml + '<li><a href="'+repositories[index].html_url+'" target="_blank">'+repositories[index].name + '</a></li>';
            });
            outhtml = outhtml + '</ul></div>';
          }
          $('#ghapidata').html(outhtml);
        } // end outputPageContent()

        document.getElementById("profile_score").innerHTML = '<img src="css/loader.gif" alt="loading...">';
        $.ajax({
          type: "POST",
          url: "/" + username,
          dataType: 'json',
          success: function(scores){


            console.log(scores);
            var scoreshtml = '<div class="row">';
            for(var i = 0; i < scores.repos.length; i++) {
              
              
              
              var repo = scores.repos[i];
              scoreshtml += '<div class="col-lg-6 mb-6"><div class="card h-100"><h4 class="card-header">' + repo.name + '</h4><div class="card-body">' +
                '<span class="outer-bar"><span class="inner-bar" style="width: ' + repo.score + '%;"></span><span class="bar-text">' + repo.score + '%</span></span>' + 
                '<canvas id="myChart' + i + '"></canvas></div><div class="card-footer"><a href="#" class="btn btn-primary">Learn More</a></div></div></div>';
 
                
                
                         
            
              }
            scoreshtml += '</div>';
            document.getElementById("profile_score").innerHTML = scoreshtml;
            for(var i = 0; i < scores.repos.length; i++) {
              var repo = scores.repos[i];

              //for(var i = 0; i < scores.repos.length; i++) {
              
              
              var ctx = document.getElementById("myChart" + i).getContext('2d');
              
              var myPieChart = new Chart(ctx,{
                type: 'pie',
                data: {
                  labels: Object.keys(repo.categories),
                  datasets : [{
                    label : "Distribution of Errors",
                    data : Object.values(repo.categories),
                    backgroundColor: [
                    'rgb(255, 99, 132)',
                    'rgb(54, 162, 235)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(255, 159, 64)',
                    'rgb(153, 102, 255)',
                    'rgb(201, 203, 207)',
                  ],
                  }]
                },
            
                options:{
                  scales: {
                    xAxes: [{
                      display: this.scalesdisplay,
                      ticks: {
                          beginAtZero:this.beginzero,
                      }
                  }],
                  yAxes: [{
                    display: this.scalesdisplay,
                    ticks: {
                        beginAtZero:this.beginzero,
                    }
                }]
                }
              }
            });
          }

          // populate code suggestions
          if(scores.messages) {
            var suggestion_element = '<p>';
            if(scores.messages.length >= 1) {
              suggestion_element += 'Unfortunately, it looks like you are having a lot of trouble with ' + scores.messages[0][2] + '.<br><br>';
            }
            if(scores.messages.length >= 2) {
              suggestion_element += 'Unfortunately, it looks like you are having some trouble with ' + scores.messages[1][2] + '.<br><br>';
            }
            if(scores.messages.length >= 3) {
              suggestion_element += 'Unfortunately, it looks like you are having a little trouble with ' + scores.messages[2][2] + '.<br><br>';
            }
            suggestion_element += '</p>';
            
            document.getElementById("profile_suggestions").innerHTML = suggestion_element;
          }
          
          } // end of success functions
        });

      } // end else statement
    }); // end requestJSON Ajax call
  }); // end click event handler
  
  function requestJSON(url, callback) {
    $.ajax({
      url: url,
      complete: function(xhr) {
        callback.call(null, xhr.responseJSON);
      }
    });
  }
});



</script>
    </header>

    <script type="text/javascript">
    	function check(){
    		var link = document.getElementById("git_profile").value;
    		document.getElementById("profile_pic").src="https://help.github.com/assets/images/help/profile/identicon.png";
    	}
    </script>

    <section id="about">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Profile Score:</h2>
            <div id="profile_score">
            <p class="lead">You haven't searched a profile yet.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="services" class="bg-light">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Code Suggestions:</h2>
            <div id="profile_suggestions">
            <p class="lead">You haven't searched a profile yet.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="contact">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>About Us:</h2>
            <p class="lead">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero odio fugiat voluptatem dolor, provident officiis, id iusto! Obcaecati incidunt, qui nihil beatae magnam et repudiandae ipsa exercitationem, in, quo totam.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom JavaScript for this theme -->
    <script src="js/scrolling-nav.js"></script>

  </body>

</html>
